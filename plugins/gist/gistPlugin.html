<!DOCTYPE html>
<html>
<head>
	<meta name="copyright" content="Copyright (c) IBM Corporation and others 2011." >
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.6/dojo/dojo.xd.js"></script>
	<script type="text/javascript" src="lib/plugin.js"></script>
	<script type="text/javascript">

function makeGist(text) {
	dojo.xhrPost({
		url: "https://api.github.com/gists",
		postData: dojo.toJson({
			"description": "Orion generated gist",
			"public": "true",
			"Directory": "true",
			"files": {
				"unnamed.txt": {
					"content": text
				}
			}
		}),
		handleAs: "json",
		timeout: 15000,
		load: function(jsonData, ioArgs) {
			return jsonData.url
		}
	});
}

// The following registers our function with the Orion text editor:
window.onload = function() {
var provider = new eclipse.PluginProvider();
var serviceImpl = {
	run : function(selectedText, text, selection) {
		var toGist;
		var selectionEmpty = selection.start === selection.end;
		if (selectionEmpty) {
			toGist = text;
		} else {
			toGist = selectedText;
		}
		var url = makeGist(toGist);
		if (url) {
			window.open(url);
		}
	}
};
var serviceProps = {
	name : "Make Gist",
	img : "http://www.github.com/favicon.ico",
	key : [ "g", false, false, true ] // alt+g
};
provider.registerServiceProvider("orion.edit.command", serviceImpl, serviceProps);
provider.connect();
};

	</script>
</head>
<body>
</body>
</html>